<!DOCTYPE html>
<html lang="en">
<head>
  <title>Aqua Control</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body onload="JavaScript:AutoRefresh(5000);">
    <!--<body>-->
<script>
    //const socket = io();

    const socket = io('localhost:3000', {
			path: '/socket.io'
		});

    var control = {"sound":0,"uptime":"2018-03-14T20:21:39.806Z","outlet":[{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 1","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 2","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 3","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 4","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 5","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"trigger":"Manual","triggername":"none","state":0,"name":"Outlet 6","sched":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}],"sensor":[{"name":"Success","data":0},{"name":"Sensor 2","data":0},{"name":"Sensor 3","data":0},{"name":"Sensor 4","data":0}]};
</script>

<!-- <img class="img-responsive" src="/images/background1.jpg" alt="background1.jpg"> -->

<!-- Screen Layouts -->

<!-- Warnings Screen -->
<div class="warnings_page" id="warnings_page">
        <div class="row">
            <div class="col">
                <button type="button" id="warnbutton" class="btn btn-info" onclick="go_home()">Home</button>
            </div>
        </div>
    </div>
    

<!-- Home Screen -->
<div class="screen_home" id="screen_home">
    <div class="maintmode_status" id="maintmode_status">
        off
    </div>
    
    <p id="date"></p>
    <script>
        var dt = new Date();
        document.getElementById("date").innerHTML = dt.toLocaleDateString();
        document.getElementById("date").innerHTML += " - " + dt.toLocaleTimeString();
    </script>

    <div class="row">
        <div class="col" id="tempreading">Temperature: </div>
    </div>
    <br>
    <div class="row" id="maintmode">
        <div class="col">
                    <p class="bg-danger text-white">Maintenance Mode!</p>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <button type="button" id="status_outlet1" class="btn btn-success" onclick="go_outlet_config(0)">1</button>
        </div>
        <div class="col">
            <button type="button" id="status_outlet2" class="btn btn-success" onclick="go_outlet_config(1)">2</button>
        </div>
        <div class="col">
            <button type="button" id="status_outlet3" class="btn btn-success" onclick="go_outlet_config(2)">3</button>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
                <button type="button" id="status_outlet4" class="btn btn-success" onclick="go_outlet_config(3)">4</button>
        </div>
        <div class="col">
                <button type="button" id="status_outlet5" class="btn btn-success" onclick="go_outlet_config(4)">5</button>
        </div>
        <div class="col">
                <button type="button" id="status_outlet6" class="btn btn-success" onclick="go_outlet_config(5)">6</button>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="warning_box" id="warning_box">
                <p></p>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-primary" onclick="go_sensor_list()">Sensors</button>
        </div>
        <div class="col">
            <button type="button" class="btn btn-warning" onclick="go_config_main()">Settings</button>
        </div>
    </div>
</div>

<!-- Main Config Screen -->
<div class="config_main" id="config_main">
    <p>Celsius or F</p>
    <p>Current time</p>
    <p>Uptime: </p>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-success" id="sound" onclick="toggle_sound()">Sound</button>
            <button type="button" class="btn btn-success">Set Time</button>
        </div>
        <br><br>
    </div>
    <div class="logbuttons">
        <button type="button" class="btn btn-info">DL Log</button>
        <button type="button" class="btn btn-info">DL Config</button>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-warning" onclick="reset_server()">RESET</button>
            <button type="button" class="btn btn-info" onclick="go_home()">Home</button>
        </div>
    </div>
    

</div>

<!-- Outlet Config -->
<div class="outlet_config" id="outlet_config" value=0>
    <div class="outlet_control" id="outlet_control"></div>
    <p>Outlet Config</p>
    <p id="outlet_config_name">Unknown Device</p>
    <div class="form-group">
        <label for="outletname">Device Name:</label>
        <input type="text" class="form-control" id="outletname">
    </div>
    <div class="dropdown">
        <button type="button" id="dbutton" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
            Control Type
        </button>
        <div class="dropdown-menu">
            <button class="dropdown-item" type="button" onclick="select_disabled()">Disabled</a>
            <button class="dropdown-item" type="button" onclick="select_manual()">Manual</a>
            <button class="dropdown-item" type="button" onclick="select_hourly()">Hourly</a>
            <button class="dropdown-item" type="button" onclick="select_sensor()">Sensor</a>
        </div>
    </div>
    <br>
    <div class="dropdown" id="manual_sensor">
        <button type="button" id="msbutton" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
            Control Sensor
        </button>
        <div class="dropdown-menu">
            <button class="dropdown-item" type="button" id="cs_button1" onclick="select_control_sensor(0)">Sensor 1</a>
            <button class="dropdown-item" type="button" id="cs_button2" onclick="select_control_sensor(1)">Sensor 2</a>
            <button class="dropdown-item" type="button" id="cs_button3" onclick="select_control_sensor(2)">Sensor 3</a>
            <button class="dropdown-item" type="button" id="cs_button4" onclick="select_control_sensor(3)">Sensor 4</a>
        </div>
        <div class="controltext">
            <br>
            <p id="controltext">Controlled by Sensor 1</p>
        </div>
    </div>
        
    <!--</div>-->
    <div class="manual_button" id="manual_button">
        <button type="button" class="btn btn-success" id="mbutton" onclick="toggle_mbutton()">Disabled</button>
    </div>
    <div class="manual_disabled" id="manual_disabled">
        <div class="alert alert-danger">
            Disabled.
        </div>
    </div>
    <div class="manual_hourly" id="manual_hourly">
        <div class="row">
            <div class="col">
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" value="" id="hour0">00 to 01
                    </label>
                </div>
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" value="" id="hour1">01 to 02
                    </label>
                </div>
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" value="" id="hour2">02 to 03
                    </label>
                </div>
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" value="" id="hour3">03 to 04                        
                    </label>
                </div>
                <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour4">04 to 05
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour5">05 to 06
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour6">06 to 07
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour7">07 to 08
                        </label>
                    </div>
                    <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour8">08 to 09
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour9">09 to 10
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour10">10 to 11
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour11">11 to 12                        
                            </label>
                        </div>
            </div>
            <div class="col">
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour12">12 to 13
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour13">13 to 14
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour14">14 to 15
                        </label>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" value="" id="hour15">15 to 16
                        </label>
                    </div>
                    <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour16">16 to 17
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour17">17 to 18
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour18">18 to 19
                            </label>
                        </div>
                        <div class="form-check">
                            <label class="form-check-label">
                                <input type="checkbox" class="form-check-input" value="" id="hour19">19 to 20
                            </label>
                        </div>
                        <div class="form-check">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" value="" id="hour20">20 to 21
                                </label>
                            </div>
                            <div class="form-check">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" value="" id="hour21">21 to 22
                                </label>
                            </div>
                            <div class="form-check">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" value="" id="hour22">22 to 23
                                </label>
                            </div>
                            <div class="form-check">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" value="" id="hour23">23 to 00                        
                                </label>
                            </div>
                </div>
        </div>
    </div>
    <br>
    <button type="button" class="btn btn-info" onclick="submit_outlet_config();go_home()">Home</button>
</div>


<!-- Sensor List -->
<div class="sensor_list" id="sensor_list">
    <div class="btn-group-vertical">
        <button type="button" class="btn btn-primary" id="sensor1" onclick="go_config_sensor(0)">1</button>
        <button type="button" class="btn btn-primary" id="sensor2" onclick="go_config_sensor(1)">2</button>
        <button type="button" class="btn btn-primary" id="sensor3" onclick="go_config_sensor(2)">3</button>
        <button type="button" class="btn btn-primary" id="sensor4" onclick="go_config_sensor(3)">4</button>
    </div>
    <br><br>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-info" onclick="go_home()">Home</button>
        </div>
    </div>
</div>

<!-- Config Sensor -->
<div class="config_sensor" id="config_sensor" value=0>
    <div class="form-group">
        <label for="sensorname">Sensor Name:</label>
        <input type="text" class="form-control" id="sensorname">
    </div>
    <div class="sensor_status" id="sensor_status">
            <button type="button" class="btn btn-danger" id="sbutton" onclick="toggle_sbutton()">Disabled</button>
        </div>
    <div class="form-group">
            <label for="sensorname">Data Type:</label>
            <input type="text" class="form-control" id="datatype"> 
        </div>
    <div class="form-group">
        <label for="lowtrigger">Low Trigger:</label>
        <input type="text" class="form-control" id="lowtrigger">
    </div>
    <div class="form-group">
        <label for="hightrigger">High Trigger:</label>
        <input type="text" class="form-control" id="hightrigger">        
    </div>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-info" onclick="submit_sensor_config();go_home();go_sensor_list()">Back</button>
        </div>
        <div class="col">
            <button type="button" class="btn btn-info" onclick="submit_sensor_config();go_home()">Home</button>
        </div>
    </div>

</div>

<!-- Control Functions -->
<script>
        function reset_server()
        {
            socket.emit('reset', control);
        }
        
        //When user clicks HOME, submit the sensor configuration information to the server.
        function submit_sensor_config()
        {
            console.log('Submit sensor config called.');
            var sensor_number = document.getElementById("config_sensor").value;
            control.sensor[sensor_number].name = document.getElementById("sensorname").value;
            control.sensor[sensor_number].lowtrigger = document.getElementById("lowtrigger").value;
            control.sensor[sensor_number].hightrigger = document.getElementById("hightrigger").value;
            control.sensor[sensor_number].datatype = document.getElementById("datatype").value;
            
            socket.emit('control update', control);
        }

        function submit_outlet_config()
        {
            console.log('Submit outlet config called.');
            var outlet_number = document.getElementById("outlet_config").value;
            control.outlet[outlet_number].sched[0] = document.getElementById("hour0").checked;
            control.outlet[outlet_number].sched[1] = document.getElementById("hour1").checked;
            control.outlet[outlet_number].sched[2] = document.getElementById("hour2").checked;
            control.outlet[outlet_number].sched[3] = document.getElementById("hour3").checked;
            control.outlet[outlet_number].sched[4] = document.getElementById("hour4").checked;
            control.outlet[outlet_number].sched[5] = document.getElementById("hour5").checked;
            control.outlet[outlet_number].sched[6] = document.getElementById("hour6").checked;
            control.outlet[outlet_number].sched[7] = document.getElementById("hour7").checked;
            control.outlet[outlet_number].sched[8] = document.getElementById("hour8").checked;
            control.outlet[outlet_number].sched[9] = document.getElementById("hour9").checked;
            control.outlet[outlet_number].sched[10] = document.getElementById("hour10").checked;
            control.outlet[outlet_number].sched[11] = document.getElementById("hour11").checked;
            control.outlet[outlet_number].sched[12] = document.getElementById("hour12").checked;
            control.outlet[outlet_number].sched[13] = document.getElementById("hour13").checked;
            control.outlet[outlet_number].sched[14] = document.getElementById("hour14").checked;
            control.outlet[outlet_number].sched[15] = document.getElementById("hour15").checked;
            control.outlet[outlet_number].sched[16] = document.getElementById("hour16").checked;
            control.outlet[outlet_number].sched[17] = document.getElementById("hour17").checked;
            control.outlet[outlet_number].sched[18] = document.getElementById("hour18").checked;
            control.outlet[outlet_number].sched[19] = document.getElementById("hour19").checked;
            control.outlet[outlet_number].sched[20] = document.getElementById("hour20").checked;
            control.outlet[outlet_number].sched[21] = document.getElementById("hour21").checked;
            control.outlet[outlet_number].sched[22] = document.getElementById("hour22").checked;
            control.outlet[outlet_number].sched[23] = document.getElementById("hour23").checked;
            control.outlet[outlet_number].name = document.getElementById("outletname").value;
            socket.emit('control update', control);

        }

        function go_home()
        {
            console.log('Go home called.');
            document.getElementById("warnings_page").style.display = 'none';
            document.getElementById("config_main").style.display = 'none';
    
            document.getElementById("outlet_config").style.display = 'none';
            
            document.getElementById("sensor_list").style.display = 'none';
    
            document.getElementById("config_sensor").style.display = 'none';
            
            refresh_warns();
            document.getElementById("screen_home").style.display = 'block';

            


        }
    
        function refresh_warns()
        {
            var numwarns = document.getElementsByClassName("alert alert-danger alert-dismissable fade show").length;
            var html = '<button type="button" class="btn btn-'
            if (numwarns > 0)
                html += 'danger';
            else
                html += 'success';
            html += '" onclick="go_warnings_page()">Warnings:   ';
            html += '<span class="badge badge-light">' + numwarns + '</span></button>';
            document.getElementById("warning_box").innerHTML = html;            
            
        }
    
        function go_sensor_list()
        {
            console.log('Go sensor list called.');
            if (control.sensor[0].status == "Disabled")
            {
                console.log('Sensor 1 is disabled.');
                $("#sensor1").removeClass("btn btn-danger");
                $("#sensor1").removeClass("btn btn-success");
                $("#sensor1").removeClass("btn btn-info");
                $("#sensor1").removeClass("btn btn-primary");
                $("#sensor1").addClass("btn");
            }
            else 
            {
                console.log('Sensor 1 is NOT disabled.');
                if ((control.sensor[0].data >= control.sensor[0].lowtrigger) && (control.sensor[0].data <= control.sensor[0].hightrigger))
                {
                    $("#sensor1").removeClass("btn btn-danger");
                    $("#sensor1").removeClass("btn btn-default");
                    $("#sensor1").removeClass("btn btn-info");
                    $("#sensor1").removeClass("btn btn-primary");
                    $("#sensor1").addClass("btn btn-success");
                }
                if (control.sensor[0].data < control.sensor[0].lowtrigger)
                {
                    $("#sensor1").removeClass("btn btn-danger");
                    $("#sensor1").removeClass("btn btn-success");
                    $("#sensor1").removeClass("btn btn-default");
                    $("#sensor1").removeClass("btn btn-primary");
                    $("#sensor1").addClass("btn btn-info");
                }
                if (control.sensor[0].data > control.sensor[0].hightrigger)
                {
                    $("#sensor1").removeClass("btn btn-default");
                    $("#sensor1").removeClass("btn btn-success");
                    $("#sensor1").removeClass("btn btn-info");
                    $("#sensor1").removeClass("btn btn-primary");
                    $("#sensor1").addClass("btn btn-danger");
                }
            }

            if (control.sensor[1].status == "Disabled")
            {
                $("#sensor2").removeClass("btn btn-danger");
                $("#sensor2").removeClass("btn btn-success");
                $("#sensor2").removeClass("btn btn-info");
                $("#sensor2").removeClass("btn btn-primary");
                $("#sensor2").addClass("btn");
            }
            else 
            {
                if ((control.sensor[1].data >= control.sensor[1].lowtrigger) && (control.sensor[1].data <= control.sensor[1].hightrigger))
                {
                    $("#sensor2").removeClass("btn btn-danger");
                    $("#sensor2").removeClass("btn btn-default");
                    $("#sensor2").removeClass("btn btn-info");
                    $("#sensor2").removeClass("btn btn-primary");
                    $("#sensor2").addClass("btn btn-success");
                }
                if (control.sensor[1].data < control.sensor[1].lowtrigger)
                {
                    $("#sensor2").removeClass("btn btn-danger");
                    $("#sensor2").removeClass("btn btn-success");
                    $("#sensor2").removeClass("btn btn-default");
                    $("#sensor2").removeClass("btn btn-primary");
                    $("#sensor2").addClass("btn btn-info");
                }
                if (control.sensor[1].data > control.sensor[1].hightrigger)
                {
                    $("#sensor2").removeClass("btn btn-default");
                    $("#sensor2").removeClass("btn btn-success");
                    $("#sensor2").removeClass("btn btn-info");
                    $("#sensor2").removeClass("btn btn-primary");
                    $("#sensor2").addClass("btn btn-danger");
                }
            }

            if (control.sensor[2].status == "Disabled")
            {
                $("#sensor3").removeClass("btn btn-danger");
                $("#sensor3").removeClass("btn btn-success");
                $("#sensor3").removeClass("btn btn-info");
                $("#sensor3").removeClass("btn btn-primary");
                $("#sensor3").addClass("btn");
            }
            else 
            {
                if ((control.sensor[2].data >= control.sensor[2].lowtrigger) && (control.sensor[2].data <= control.sensor[2].hightrigger))
                {
                    $("#sensor3").removeClass("btn btn-danger");
                    $("#sensor3").removeClass("btn btn-default");
                    $("#sensor3").removeClass("btn btn-info");
                    $("#sensor3").removeClass("btn btn-primary");
                    $("#sensor3").addClass("btn btn-success");
                }
                if (control.sensor[2].data < control.sensor[2].lowtrigger)
                {
                    $("#sensor3").removeClass("btn btn-danger");
                    $("#sensor3").removeClass("btn btn-success");
                    $("#sensor3").removeClass("btn btn-default");
                    $("#sensor3").removeClass("btn btn-primary");
                    $("#sensor3").addClass("btn btn-info");
                }
                if (control.sensor[2].data > control.sensor[2].hightrigger)
                {
                    $("#sensor3").removeClass("btn btn-default");
                    $("#sensor3").removeClass("btn btn-success");
                    $("#sensor3").removeClass("btn btn-info");
                    $("#sensor3").removeClass("btn btn-primary");
                    $("#sensor3").addClass("btn btn-danger");
                }
            }

            if (control.sensor[3].status == "Disabled")
            {
                $("#sensor4").removeClass("btn btn-danger");
                $("#sensor4").removeClass("btn btn-success");
                $("#sensor4").removeClass("btn btn-info");
                $("#sensor4").removeClass("btn btn-primary");
                $("#sensor4").addClass("btn");
            }
            else 
            {
                if ((control.sensor[3].data >= control.sensor[3].lowtrigger) && (control.sensor[3].data <= control.sensor[3].hightrigger))
                {
                    $("#sensor4").removeClass("btn btn-danger");
                    $("#sensor4").removeClass("btn btn-default");
                    $("#sensor4").removeClass("btn btn-info");
                    $("#sensor4").removeClass("btn btn-primary");
                    $("#sensor4").addClass("btn btn-success");
                }
                if (control.sensor[3].data < control.sensor[3].lowtrigger)
                {
                    $("#sensor4").removeClass("btn btn-danger");
                    $("#sensor4").removeClass("btn btn-success");
                    $("#sensor4").removeClass("btn btn-default");
                    $("#sensor4").removeClass("btn btn-primary");
                    $("#sensor4").addClass("btn btn-info");
                }
                if (control.sensor[3].data > control.sensor[3].hightrigger)
                {
                    $("#sensor4").removeClass("btn btn-default");
                    $("#sensor4").removeClass("btn btn-success");
                    $("#sensor4").removeClass("btn btn-info");
                    $("#sensor4").removeClass("btn btn-primary");
                    $("#sensor4").addClass("btn btn-danger");
                }
            }
            


            document.getElementById("sensor1").innerHTML = control.sensor[0].name + " : " + control.sensor[0].data;
            document.getElementById("sensor2").innerHTML = control.sensor[1].name + " : " + control.sensor[1].data;
            document.getElementById("sensor3").innerHTML = control.sensor[2].name + " : " + control.sensor[2].data;
            document.getElementById("sensor4").innerHTML = control.sensor[3].name + " : " + control.sensor[3].data;

            document.getElementById("screen_home").style.display = 'none';
            document.getElementById("sensor_list").style.display = 'block';
        }
    
    
        function go_outlet_config(outlet_number) 
        {
            console.log('Go outlet config called.');
            go_home();
            document.getElementById("outlet_config").value = outlet_number;
            document.getElementById("screen_home").style.display = 'none';
            document.getElementById("manual_hourly").style.display = 'none';
            document.getElementById("manual_disabled").style.display = 'none';
            document.getElementById("manual_button").style.display = 'none';
            document.getElementById("manual_sensor").style.display = 'none';
            
            if (control.outlet[outlet_number].state == 0)
            {
                $("#mbutton").removeClass("btn btn-success").addClass("btn btn-danger");
            }
            else
            {
                $("#mbutton").removeClass("btn btn-danger").addClass("btn btn-success");
            }

            document.getElementById("cs_button1").innerHTML = control.sensor[0].name;
            document.getElementById("cs_button2").innerHTML = control.sensor[1].name;
            document.getElementById("cs_button3").innerHTML = control.sensor[2].name;
            document.getElementById("cs_button4").innerHTML = control.sensor[3].name;

            document.getElementById("controltext").innerHTML = "Controlled by " + control.sensor[control.outlet[outlet_number].triggersensor].name;

            
            document.getElementById("outlet_config_name").innerHTML = control.outlet[outlet_number].name;
            document.getElementById("outletname").value = control.outlet[outlet_number].name;

            document.getElementById("hour0").checked = control.outlet[outlet_number].sched[0];
            document.getElementById("hour1").checked = control.outlet[outlet_number].sched[1];
            document.getElementById("hour2").checked = control.outlet[outlet_number].sched[2];
            document.getElementById("hour3").checked = control.outlet[outlet_number].sched[3];
            document.getElementById("hour4").checked = control.outlet[outlet_number].sched[4];
            document.getElementById("hour5").checked = control.outlet[outlet_number].sched[5];
            document.getElementById("hour6").checked = control.outlet[outlet_number].sched[6];
            document.getElementById("hour7").checked = control.outlet[outlet_number].sched[7];
            document.getElementById("hour8").checked = control.outlet[outlet_number].sched[8];
            document.getElementById("hour9").checked = control.outlet[outlet_number].sched[9];
            document.getElementById("hour10").checked = control.outlet[outlet_number].sched[10];
            document.getElementById("hour11").checked = control.outlet[outlet_number].sched[11];
            document.getElementById("hour12").checked = control.outlet[outlet_number].sched[12];
            document.getElementById("hour13").checked = control.outlet[outlet_number].sched[13];
            document.getElementById("hour14").checked = control.outlet[outlet_number].sched[14];
            document.getElementById("hour15").checked = control.outlet[outlet_number].sched[15];
            document.getElementById("hour16").checked = control.outlet[outlet_number].sched[16];
            document.getElementById("hour17").checked = control.outlet[outlet_number].sched[17];
            document.getElementById("hour18").checked = control.outlet[outlet_number].sched[18];
            document.getElementById("hour19").checked = control.outlet[outlet_number].sched[19];
            document.getElementById("hour20").checked = control.outlet[outlet_number].sched[20];
            document.getElementById("hour21").checked = control.outlet[outlet_number].sched[21];
            document.getElementById("hour22").checked = control.outlet[outlet_number].sched[22];
            document.getElementById("hour23").checked = control.outlet[outlet_number].sched[23];

            if (control.outlet[outlet_number].trigger == "Disabled")
            {
                console.log('Disabled shown.');
                document.getElementById("manual_disabled").style.display = 'block';
            }
            if (control.outlet[outlet_number].trigger == "Manual")
            {
                console.log('Manual shown.');
                document.getElementById("manual_button").style.display = 'block';
            }
            if (control.outlet[outlet_number].trigger == "Hourly")
            {
                console.log('Hourly shown.');
                document.getElementById("manual_hourly").style.display = 'block';
            }
            if (control.outlet[outlet_number].trigger == "Sensor")
            {
                console.log('Sensor shown.');
                document.getElementById("manual_sensor").style.display = 'block';
            }

            document.getElementById("outlet_config").style.display = 'block';
        }

        function select_control_sensor(sensor_number)
        {
            outlet_number = document.getElementById("outlet_config").value;
            document.getElementById("controltext").innerHTML = "Controlled by " + control.sensor[sensor_number].name;
            control.outlet[outlet_number].trigger = "Sensor";
            control.outlet[outlet_number].triggersensor = sensor_number;
            socket.emit('control update', control);
        }

        function go_config_main()
        {
            console.log('Go config main called.');
            go_home();
            document.getElementById("screen_home").style.display = 'none';
            document.getElementById("config_main").style.display='block';
        }
    
        function go_config_sensor(sensor_number)
        {
            console.log('Go config sensor called.');
            go_home();
            document.getElementById("sensorname").value = control.sensor[sensor_number].name;
            document.getElementById("lowtrigger").value = control.sensor[sensor_number].lowtrigger;
            document.getElementById("hightrigger").value = control.sensor[sensor_number].hightrigger;
            document.getElementById("datatype").value = control.sensor[sensor_number].datatype;
            document.getElementById("config_sensor").value = sensor_number;
            document.getElementById("screen_home").style.display = 'none';
            
            if (control.sensor[sensor_number].status === 'Disabled')
            {
                console.log('Button is disabled.');
                $('#sbutton').removeClass("btn btn-success").addClass("btn btn-danger");
                document.getElementById('sbutton').innerHTML = "Disabled";
            }
            else
            {
                console.log('Button is enabled.');
                $('#sbutton').removeClass("btn btn-danger").addClass("btn btn-success");
                document.getElementById('sbutton').innerHTML = "Enabled";
            }
            document.getElementById("config_sensor").style.display='block';
        }
    
        function go_warnings_page()
        {
            console.log('Go warnings page called.');
            go_home();
            document.getElementById("screen_home").style.display = 'none';
            document.getElementById("warnings_page").style.display='block';
        }

        function select_hourly()
        {
            var outlet_number = document.getElementById("outlet_config").value;
            //document.getElementById("screen_home").style.display = 'none';
            document.getElementById("manual_hourly").style.display = 'block';
            document.getElementById("manual_disabled").style.display = 'none';
            document.getElementById("manual_button").style.display = 'none';
            document.getElementById("manual_sensor").style.display = 'none';
            //document.getElementById("outlet1_control").textContent = "hourly";
            control.outlet[outlet_number].trigger = "Hourly";
            control.outlet[outlet_number].state = 0;
            control.outlet[outlet_number].name = document.getElementById("outletname").value;
            //socket.emit('control update', control);
        }

        function select_sensor()
        {
            console.log('Select sensor called.');
            var outlet_number = document.getElementById("outlet_config").value;
            //document.getElementById("screen_home").style.display = 'none';
            document.getElementById("manual_hourly").style.display = 'none';
            document.getElementById("manual_disabled").style.display = 'none';
            document.getElementById("manual_button").style.display = 'none';
            document.getElementById("manual_sensor").style.display = 'block';
            //document.getElementById("outlet1_control").textContent = "hourly";
            control.outlet[outlet_number].trigger = "Sensor";
            control.outlet[outlet_number].state = 0;
            control.outlet[outlet_number].name = document.getElementById("outletname").value;
            //socket.emit('control update', control);

        }

        function select_manual()
        {
            var outlet_number = document.getElementById("outlet_config").value;
            //document.getElementById("screen_home").style.display = 'none';
            document.getElementById("manual_hourly").style.display = 'none';
            document.getElementById("manual_disabled").style.display = 'none';
            document.getElementById("manual_sensor").style.display = 'none';
            document.getElementById("manual_button").style.display = 'block';
            control.outlet[outlet_number].trigger = "Manual";
            control.outlet[outlet_number].state = 0;
            control.outlet[outlet_number].name = document.getElementById("outletname").value;
            //socket.emit('control update', control);
            
        }

        function toggle_sbutton()
        {
            console.log('Toggle sbutton called.');
            var ref_sensor = document.getElementById("config_sensor").value;
            console.log('Ref sensor = ' + ref_sensor);
            var btnclassName = $('#sbutton').attr('class');
            //if (btnclassName == "btn btn-success")
            if (control.sensor[ref_sensor].status == "Enabled")
            {
                $('#sbutton').removeClass("btn btn-success").addClass("btn btn-danger");
                document.getElementById('sbutton').innerHTML = "Disabled";
                control.sensor[ref_sensor].status = "Disabled";
                //control.outlet[0].name = document.getElementById("outletname1").value;
                socket.emit('control update', control);

            }
            else
            {
                $('#sbutton').removeClass("btn btn-danger").addClass("btn btn-success");
                control.sensor[ref_sensor].status = "Enabled";
                document.getElementById('sbutton').innerHTML = "Enabled";
                //control.outlet[0].name = document.getElementById("outletname1").value;
                socket.emit('control update', control);
            }
        }

        function toggle_mbutton()
        {
            console.log('Toggle mbutton called.');
            var outlet_number = document.getElementById("outlet_config").value;
            var btnclassName = $('#mbutton').attr('class');
            //if (btnclassName == "btn btn-success")
            if (control.outlet[outlet_number].status == 1)
            {
                $("#mbutton").removeClass("btn btn-success").addClass("btn btn-danger");
                document.getElementById("mbutton").innerHTML = "Disabled";
                control.outlet[outlet_number].state = 0;
                control.outlet[outlet_number].name = document.getElementById("outletname").value;
                socket.emit('control update', control);

            }
            else
            {
                $("#mbutton").removeClass("btn btn-danger").addClass("btn btn-success");
                document.getElementById("mbutton").innerHTML = "Enabled";
                control.outlet[outlet_number].state = 1;
                control.outlet[outlet_number].name = document.getElementById("outletname").value;
                socket.emit('control update', control);
            }
        }

        function select_disabled()
        {
            //document.getElementById("screen_home").style.display = 'none';
            var outlet_number = document.getElementById("outlet_config").value;
            document.getElementById("manual_hourly").style.display = 'none';
            document.getElementById("manual_disabled").style.display = 'block';
            document.getElementById("manual_button").style.display = 'none';
            document.getElementById("manual_sensor").style.display = 'none';
            control.outlet[outlet_number].trigger = "Disabled";
            control.outlet[outlet_number].state = 0;
            control.outlet[outlet_number].name = document.getElementById("outletname").value;
            //socket.emit('control update', control);
        }

        function toggle_sound()
        {
            var btnclassName = $('#sound').attr('class');
            if (btnclassName === "btn btn-success")
            {
                $("#sound").removeClass("btn btn-success").addClass("btn btn-danger");
                control.sound = 0;
                socket.emit('control update', control);

            }
            else
            {
                $("#sound").removeClass("btn btn-danger").addClass("btn btn-success");
                control.sound = 1;
                socket.emit('control update', control);
            }
        }

        function setup_maintmode()
        {
            if (document.getElementById("maintmode_status").textContent === "on")
                document.getElementById("maintmode").style.display = 'block';
            else
                document.getElementById("maintmode").style.display = 'none';
        }

        function set_maintmode(toggle)
        {
            document.getElementById("maintmode_status").textContent = toggle;
        }

        refresh_warns();

        setup_maintmode();

        //alert("Setup complete.");

    </script>


<!-- Style Display Hiders -->

<style>
    .screen_home {
	display: block;
    }
    .warnings_page {
	display: none;
    }
    .config_main {
	display: none;
    }
    .outlet_config {
	display: none;
    }
    .sensor_list {
	display: none;
    }
    .config_sensor {
	display: none;
    }
    #warnings_set {
    display: none;
    }
    .manual_button {
    display: none;
    }
    .manual_sensor {
    display: none;
    }
    .manual_disabled {
    display: none;
    }
    .manual_hourly {
    display: none;
    }
    .mbutton {
    display: block;
    }
    .outlet1_control {
    display: none;
    }
    .maintmode_status {
    display: none;
    }
</style>

<!--
<style>
.screen_home {
    float: left;
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 0 5px 0 5px;
    width: 240px;
}
</style>
-->

<!-- Style Definitions -->



<style>
body {
    background-image: url("images/background1.jpg");
    background-color: #cccccc;
    background-blend-mode: darken;
    background-size: cover;
}
.screen_home {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
.sensor_list {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
.outlet_config {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
.warnings_page {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
.config_main {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
.config_sensor {
    margin: auto;
    margin-top: 100px;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    width: 240px;
    background-color: #cccccc;
}
</style>


<!--
<style>
.screen_home {
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    
}
.sensor_list {
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    
}
.outlet_config1 {
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    
}
.warnings_page {
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    
}
.config_main {
    margin: 0 20px 20px 0;
    border: 1px solid blue;
    padding: 5px 5px 5px 5px;
    
}
</style>
-->


<script>
    
    

    socket.on('setup', function(msg)
    {
        control = msg;
    });

    socket.on('control update', function(msg)
    {
        control = msg;
        //console.log(msg);

        if (control.outlet[0].state == 0)
        {
            $("#status_outlet1").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet1").removeClass("btn btn-danger").addClass("btn btn-success");
        }

        if (control.outlet[1].state == 0)
        {
            $("#status_outlet2").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet2").removeClass("btn btn-danger").addClass("btn btn-success");
        }

        if (control.outlet[2].state == 0)
        {
            $("#status_outlet3").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet3").removeClass("btn btn-danger").addClass("btn btn-success");
        }

        if (control.outlet[3].state == 0)
        {
            $("#status_outlet4").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet4").removeClass("btn btn-danger").addClass("btn btn-success");
        }

        if (control.outlet[4].state == 0)
        {
            $("#status_outlet5").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet5").removeClass("btn btn-danger").addClass("btn btn-success");
        }

        if (control.outlet[5].state == 0)
        {
            $("#status_outlet6").removeClass("btn btn-success").addClass("btn btn-danger");
        }
        else
        {
            $("#status_outlet6").removeClass("btn btn-danger").addClass("btn btn-success");
        }
        document.getElementById("sensor1").innerHTML = control.sensor[0].name + " : " + control.sensor[0].data;
        document.getElementById("sensor2").innerHTML = control.sensor[1].name + " : " + control.sensor[1].data;
        document.getElementById("sensor3").innerHTML = control.sensor[2].name + " : " + control.sensor[2].data;
        document.getElementById("sensor4").innerHTML = control.sensor[3].name + " : " + control.sensor[3].data;
        document.getElementById("tempreading").innerHTML = "Temperature: " + control.sensor[0].data + "°F";

        //console.log('dbutton1 innerhtml: ' + document.getElementById("dbutton1").innerHTML);
        //document.getElementById("dbutton1").innerHTML = control.outlet[0].trigger;
        //console.log('dbutton1: ' + control.outlet[0].trigger);
        //document.getElementById("dbutton2").innerHTML = control.outlet[1].trigger;

        for (var i = 0, len = control.warning.length; i < len; i++) 
        {
            var check = document.getElementById('warn' + control.warning[i].type);
            
            //figure out a way to add a counter to it
            //if (check != null)
                

            if ((control.warning[i].type != 0) && (check == null))
            {
                //fuck
                //<button type="button" class="close" data-dismiss="alert">&times;</button>
                console.log('Warning rxd from server.');
                console.log('Warning: ' + control.warning[i].text);
                var output = document.getElementById("warnings_page");
                var ele = document.createElement("div");
                ele.setAttribute("class","alert alert-danger alert-dismissable fade show");
                ele.setAttribute('id', 'warn' + control.warning[i].type);
                var butt = document.createElement('a');
                butt.setAttribute('href', '#');
                butt.setAttribute('class', 'close');
                //butt.setAttribute("button type", "button");
                butt.setAttribute('data-dismiss', 'alert');
                butt.setAttribute('aria-label','close');
                butt.innerHTML = '&times;';
                    
                ele.innerHTML = control.warning[i].text;
                ele.appendChild(butt);
                
                //output.appendChild(ele);
                var parentDiv = document.getElementById("warnbutton").parentNode;
                var warn = document.getElementById("warnbutton");
                parentDiv.insertBefore(ele, warn);

                //console.log(msg);
            }
        }

        refresh_warns();
        
    });

    socket.on('sensor update', function(msg)
    {
        document.getElementById("sensor1").innerHTML = control.sensor[0].name + " : " + control.sensor[0].data;
        document.getElementById("sensor2").innerHTML = control.sensor[1].name + " : " + control.sensor[1].data;
        document.getElementById("sensor3").innerHTML = control.sensor[2].name + " : " + control.sensor[2].data;
        document.getElementById("sensor4").innerHTML = control.sensor[3].name + " : " + control.sensor[3].data;
        document.getElementById("tempreading").innerHTML = "Temperature: " + control.sensor[0].data + "°F";
        //console.log(msg);
    });

    socket.on('warning', function(msg)
    {
        control = msg;
            
        refresh_warns();
        //location.reload(true);

    });


</script>

<script type="text/JavaScript">
    //<!--
        function update()
        {
            socket.emit('update', 'fetch update requested from web');
        }

       function AutoRefresh( t ) 
       {
          setInterval(update, t);
       }
    //-->
 </script>

</body>
</html>
